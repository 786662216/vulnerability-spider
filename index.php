<?php
/**
 * Created by PhpStorm.
 * User: 78666
 * Date: 2018/4/2
 * Time: 12:04
 */


/*
 * 生成分页码
 * param int $num 文章总数
 * param int $curr 当前显示的页码数
 * param int $cnt 每页显示的条数
 *
 */

function getPage($num,$curr,$cnt)
{
    //最大的页码数
    $max = ceil($num / $cnt);
    //最左侧页码
    $left = max(1, $curr - 2);
    //最右侧页码
    $right = min($left + 4, $max);

    $page = array();
    for ($i = $left; $i <= $right; $i++) {
        $_GET['page'] = $i;
        $page[$i] = http_build_query($_GET);
    }
    return $page;
}

$cve = array();
$file = fopen('seebug.csv','r');
while($data = fgetcsv($file)){
    array_push($cve,$data);
}
$file = fopen('CVE.csv','r');
while($data = fgetcsv($file)){
    if(empty($data[0])){
    continue;
}
    $data[4] = $data[0];
    array_push($cve,$data);
}

$file = fopen('CNVD.csv','r');
while($data = fgetcsv($file)){
    array_push($cve,$data);
}
array_shift($cve[0]);
array_shift($cve[0]);
array_shift($cve[0]);
array_shift($cve[0]);

$cve = array_reverse($cve);

//print_r($cve);

fclose($file);
//foreach ($cve as $a){
//    foreach ($a as $b){
//        echo $b . '<br>';
//    }
//}

$num = count($cve);//总的文章数
$curr = isset($_GET['page']) ? $_GET['page'] : 1;
$cnt = 5;//每页显示条数
$cve = array_slice($cve,($curr-1)*$cnt,$cnt);
$page = getPage($num,$curr,$cnt);

require ('moban.html');

